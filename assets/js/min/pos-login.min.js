window.addEventListener('DOMContentLoaded', () => {

    let submitBtn = document.querySelector('form[name=posloginform]');

    if (!!submitBtn) {

        let usernameEl = document.querySelector("input[name=log]");
        let passwordEl = document.querySelector("input[name=pwd]");
        let rememberMeEl = document.querySelector("#rememberme");

        submitBtn.addEventListener('submit', (event) => {
            event.preventDefault();

            var username =  usernameEl.value;
            var password = passwordEl.value;

            if (!!username && !!password) {

                indexedDB.deleteDatabase('pos');

                if (!!rememberMeEl && rememberMeEl.checked) {
                    localStorage.usrname =username;
                    localStorage.pass = password;
                    localStorage.chkbx = rememberMeEl.value;

                } else {
                    localStorage.usrname = '';
                    localStorage.pass = '';
                    localStorage.chkbx = '';
                }

                if (localStorage.cashdrawer && !!localStorage.cashdrawer) {
                    localStorage.removeItem('cashdrawer');
                }

                document.querySelector("#posloginform").submit();

            } else {
                let errorEl = document.querySelector('.wkwcpos-login-error');
                if (!!errorEl) {
                    errorEl.style.display = "block";
                }

            }
        });

        if (localStorage.chkbx && !!localStorage.chkbx) {
            rememberMeEl.setAttribute('checked', 'checked');
            usernameEl.value = localStorage.usrname;
            passwordEl.value = localStorage.pass;
        } else {
            rememberMeEl.removeAttribute('checked');
            usernameEl.value = '';
            passwordEl.value = '';
        }
    }

});
